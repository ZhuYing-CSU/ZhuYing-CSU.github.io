{"meta":{"title":"æ™“é£æ˜¼å½±","subtitle":"","description":"è®°å½•æ—¥å¸¸ç¬”è®°åŠæ€è€ƒ","author":"ä¸€æŠ¹ç«¹å½±","url":"http://example.com","root":"/"},"pages":[{"title":"æ–‡ç« å½’æ¡£","date":"2022-06-09T13:03:38.505Z","updated":"2022-06-09T13:03:38.505Z","comments":true,"path":"archive.html","permalink":"http://example.com/archive.html","excerpt":"","text":""}],"posts":[{"title":"Pytorchåœ¨Androidç«¯ä¸­çš„åº”ç”¨æµç¨‹","slug":"Pytorchåœ¨Androidç«¯ä¸­çš„åº”ç”¨æµç¨‹","date":"2022-06-09T07:53:00.000Z","updated":"2022-06-09T13:20:47.979Z","comments":true,"path":"2022/06/09/Pytorchåœ¨Androidç«¯ä¸­çš„åº”ç”¨æµç¨‹/","link":"","permalink":"http://example.com/2022/06/09/Pytorch%E5%9C%A8Android%E7%AB%AF%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E6%B5%81%E7%A8%8B/","excerpt":"","text":"æ¨¡å‹é¢„å¤„ç† åœ¨ç¥ç»ç½‘ç»œæ¨¡å‹è®­ç»ƒå¥½åï¼Œéœ€è¦ä½¿ç”¨jitä¸­çš„scriptå‡½æ•°å°†æ¨¡å‹è½¬ä¸ºTorchscriptè¯­è¨€ï¼Œç„¶åå†ç”¨optimize_for_mobileå‡½æ•°å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œæœ€åå†ä½¿ç”¨_save_for_lite_interpreterå‡½æ•°ä¿å­˜ä¸ºå¯ç”¨äºpytorch-liteçš„ç¥ç»ç½‘ç»œæ¨¡å‹æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š import torchfrom torch.utils.mobile_optimizer import optimize_for_mobilemodel.eval() # assume model had loaded or trained# convert python to torchscriptscripted_model = torch.jit.script(model)optimized_scripted_model = optimize_for_mobile(scripted_model)optimized_scripted_model._save_for_lite_interpreter(\"your_file.tpl\") Android Project build.gradle è®¾ç½® åœ¨dependenciesä¸€é¡¹ä¸­åŠ å…¥ä¸‹åˆ—å†…å®¹ // Pytorch-lite framework (ver: 1.9.0)implementation 'org.pytorch:pytorch_android_lite:1.9.0'implementation 'org.pytorch:pytorch_android_torchvision:1.9.0' æ¨¡å‹ä½¿ç”¨ è¯»å–æ¨¡å‹ Module yourModel = LiteModuleLoader.load(modelFilePath); è¯»å–å›¾ç‰‡ å¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„éœ€è¦çš„è¯ï¼Œç›´æ¥ç”¨Bitmapå»è¯»å–å›¾åƒæ–‡ä»¶å³å¯ã€‚ Bitmap img = BitmapFactory.decodeFile(imgFilePath); æ¨¡å‹ä½¿ç”¨ Tensor input = TensorImageUtils.bitmapToFloat32Tensor( originalImg, TensorImageUtils.TORCHVISION_NORM_MEAN_RGB, TensorImageUtils.TORCHVISION_NORM_STD_RGB);Tensor output = nnModel.forward(IValue.from(input)).toTensor(); ä¸Šè¿°ä»£ç ä¸­ï¼Œå°†Bitmapç±»å‹è½¬æ¢ä¸ºTensorç±»å‹æ—¶åšäº†normalizationçš„é¢„å¤„ç†ï¼Œä½†å¯ä»¥ä¸åšã€‚ æ¨¡å‹è¾“å‡ºè½¬æ¢ä¸ºå›¾ç‰‡ ç”±äºæ¨¡å‹çš„è¾“å‡ºç±»å‹ä¸ºTensorï¼Œè‹¥éœ€è¦ä½¿ç”¨opencvçš„Matç±»å‹çš„è¯ï¼Œéœ€è¦ä¾æ¬¡è½¬æ¢æ ¼å¼ä¸ºFloatArrayï¼ŒFloatBufferï¼ŒByteBufferï¼Œæœ€ååˆ°Matï¼Œç›¸å…³ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ private static ByteBuffer FloatBuffer2ByteBuffer(FloatBuffer originBuffer){ ByteBuffer ret = ByteBuffer.allocateDirect(originBuffer.remaining() * 64); ret.order(ByteOrder.nativeOrder()); originBuffer.mark(); ret.asFloatBuffer().put(originBuffer); originBuffer.reset(); ret.rewind(); return ret;}private static Mat byteArray2Mat(ByteBuffer byteBuffer, int width, int height){ return new Mat(width, height, CvType.CV_64FC3, byteBuffer);}private static Mat Tensor2Mat(Tensor input){ return byteArray2Mat( FloatBuffer2ByteBuffer(FloatBuffer.wrap(input.getDataAsFloatArray())), (int) input.shape()[2], (int) input.shape()[3] );} something ğ•š something ğ•š","categories":[],"tags":[{"name":"Android","slug":"Android","permalink":"http://example.com/tags/Android/"},{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"},{"name":"Pytorch","slug":"Pytorch","permalink":"http://example.com/tags/Pytorch/"},{"name":"Deep Learning","slug":"Deep-Learning","permalink":"http://example.com/tags/Deep-Learning/"}]},{"title":"Makefile Helper","slug":"Makefile-Helper","date":"2022-06-08T15:52:07.000Z","updated":"2022-06-09T13:17:47.599Z","comments":true,"path":"2022/06/09/Makefile-Helper/","link":"","permalink":"http://example.com/2022/06/09/Makefile-Helper/","excerpt":"","text":".PHONY: test helptarget_name: ## it is the description @echo &quot;do nothing&quot; help: @grep -E &#x27;^[a-zA-Z_-]+:.*?## .*$$&#x27; $(MAKEFILE_LIST) | sort | awk &#x27;BEGIN &#123;FS = &quot;:.*?## &quot;&#125;; &#123;printf &quot;\\033[36m%-30s\\033[0m %s\\n&quot;, $$1, $$2&#125;&#x27;","categories":[],"tags":[{"name":"make","slug":"make","permalink":"http://example.com/tags/make/"},{"name":"Makefile","slug":"Makefile","permalink":"http://example.com/tags/Makefile/"}]}],"categories":[],"tags":[{"name":"Android","slug":"Android","permalink":"http://example.com/tags/Android/"},{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"},{"name":"Pytorch","slug":"Pytorch","permalink":"http://example.com/tags/Pytorch/"},{"name":"Deep Learning","slug":"Deep-Learning","permalink":"http://example.com/tags/Deep-Learning/"},{"name":"make","slug":"make","permalink":"http://example.com/tags/make/"},{"name":"Makefile","slug":"Makefile","permalink":"http://example.com/tags/Makefile/"}]}